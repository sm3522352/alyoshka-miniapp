/* ===== Base tokens (Default – мягкий светлый) ===== */
:root{
  color-scheme: light;
  font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  -webkit-text-size-adjust: 100%;
  --bg:#F6FAF8;
  --surface:#FFFFFF;
  --surface-alt:#F1F5F9;
  --surface-muted:#EEF5F2;
  --text:#0F172A;
  --muted:#475569;
  --line:#D9F3EA;
  --primary:#0EA5A4;
  --primary-strong:#0C8D8C;
  --primary-soft:#E6FFFB;
  --ok:#10B981;
  --warn:#F59E0B;
  --err:#E11D48;
  --info:#0284C7;
  --success:var(--ok);
  --warning:var(--warn);
  --danger:var(--err);
  --r-xl:24px;
  --r-lg:16px;
  --r-md:12px;
  --pad:16px;
  --pad-sm:12px;
  --pad-lg:24px;
  --gap:16px;
  --shadow:0 10px 28px rgba(16,185,129,.12);
  --shadow-soft:0 4px 16px rgba(15,118,110,.12);
  --fz:clamp(16px, 2.3vw, 18px);
  --lh:clamp(24px, 3.1vw, 26px);
  --h1:clamp(22px, 4.8vw, 28px);
  --h2:clamp(18px, 3.8vw, 22px);
  --h3:clamp(18px, 3.2vw, 20px);
}

.big-text{
  --fz:clamp(18px, 2.8vw, 22px);
  --lh:clamp(28px, 3.6vw, 30px);
  --h1:clamp(24px, 5.6vw, 32px);
  --h2:clamp(20px, 4.6vw, 26px);
  --h3:clamp(20px, 3.8vw, 24px);
}

/* ===== High-contrast (AA/AAA) ===== */
.high-contrast{
  color-scheme: light;
  --bg:#F3F7F6;
  --surface:#FFFFFF;
  --surface-alt:#E0F2F1;
  --surface-muted:#E6F4F1;
  --text:#0A0F1A;
  --muted:#111827;
  --line:#94D5C6;
  --primary:#047857;
  --primary-strong:#065F46;
  --primary-soft:#D1FAE5;
  --shadow:0 14px 32px rgba(4,120,87,.24);
  --shadow-soft:0 6px 18px rgba(4,120,87,.18);
}

/* ===== Night (спокойный тёмный) ===== */
.night{
  color-scheme: dark;
  --bg:#0B1220;
  --surface:#0F172A;
  --surface-alt:#111C32;
  --surface-muted:#14213D;
  --text:#F8FAFC;
  --muted:#C7D2FE;
  --line:#1E293B;

  --primary:#22D3EE;
  --primary-strong:#06B6D4;
  --primary-soft:#083344;

  --success:#34D399;
  --warning:#FBBF24;
  --danger:#FB7185;
  --info:#38BDF8;

  --shadow:0 10px 28px rgba(8,145,178,.28);
  --shadow-soft:0 6px 20px rgba(8,145,178,.22);
}

/* ===== Типографика/оболочка ===== */
html,body{height:100%;}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-size:var(--fz);
  line-height:var(--lh);
  font-family:inherit;
  transition:background .3s ease,color .3s ease;
}
:focus-visible{ outline:3px solid var(--primary); outline-offset:2px; }

*,*::before,*::after{ box-sizing:border-box; }
img{ max-width:100%; height:auto; display:block; }
button,input,textarea,select{ font:inherit; color:inherit; }

a{ color:var(--primary-strong); text-decoration:underline; text-decoration-thickness:2px; }
a:hover{ color:var(--primary); }

.hidden{ display:none !important; }
.sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
.text-muted{ color:var(--muted); }
.text-strong{ font-weight:700; }
.text-lg{ font-size:calc(var(--fz) + 2px); line-height:1.4; }
.text-sm{ font-size:16px; line-height:22px; }
.text-xs{ font-size:14px; line-height:20px; }
.text-wrap{ display:inline; word-break:break-word; }
.stack{ display:flex; flex-direction:column; gap:16px; }
.stack-sm{ gap:12px; }
.stack-xs{ gap:8px; }
.stack-lg{ gap:24px; }

/* Safe area + макет */
.app-shell{
  min-height:100dvh;
  padding-bottom:calc(env(safe-area-inset-bottom,0) + 84px);
  display:flex;
  flex-direction:column;
}
.app-header{
  width:100%;
  padding:0 0 12px;
  display:flex;
  gap:16px;
  align-items:center;
}
.app-header__icon{ width:56px; height:56px; border-radius:20px; background:var(--primary-soft); display:flex; align-items:center; justify-content:center; box-shadow:var(--shadow-soft); }
.app-header__icon img{ width:28px; height:28px; }
.app-title{ margin:0; font-size:var(--h1); font-weight:800; }
.app-subtitle{ margin:4px 0 0; font-size:16px; color:var(--muted); }

.pages{
  width:100%;
  max-width:640px;
  margin:0 auto;
  padding:calc(env(safe-area-inset-top,0) + 8px) 16px 16px;
  height:calc(100dvh - (env(safe-area-inset-bottom,0) + 84px));
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  gap:24px;
}
.view{display:none; flex-direction:column; gap:24px;}
.view.active{display:flex;}
.section-title{display:flex; align-items:center; gap:10px; margin:8px 0 6px; font-size:var(--h2); font-weight:800;}
.section-title .title{font-size:var(--h1); line-height:1.15; word-break:break-word;}
.section-note{color:var(--muted); font-size:14px;}

/* Карточки/заголовки */
.card{background:var(--surface); border:1px solid var(--line); border-radius:var(--r-xl); box-shadow:var(--shadow); padding:16px; transition:transform .15s ease, box-shadow .2s ease;}
.card:hover{box-shadow:0 16px 32px rgba(15,118,110,.18);}
.card:active{transform:scale(.99);}
.card__header{display:flex; justify-content:space-between; align-items:flex-start; gap:16px; margin-bottom:16px;}
.card__title-group{display:flex; gap:12px; align-items:center;}
.card__title{margin:0; font-size:var(--h2); font-weight:700; line-height:1.2; word-break:break-word;}
.card__body{display:flex; flex-direction:column; gap:16px;}
.card__content{display:flex; flex-direction:column; gap:10px;}
.card__cta{margin-top:8px;}
.icon-chip{width:52px; height:52px; border-radius:999px; display:flex; align-items:center; justify-content:center; background:var(--primary-soft); color:var(--primary-strong); flex-shrink:0;}
.icon-chip img{width:26px; height:26px;}

/* Формы */
.form-field{display:flex; flex-direction:column; gap:6px;}
.form-label{font-size:16px; font-weight:600; color:var(--text);}
.input, select, textarea{width:100%; padding:14px 16px; border-radius:var(--r-lg); border:1px solid var(--line); background:var(--surface-muted); color:var(--text); transition:border .2s ease, box-shadow .2s ease, background .2s ease;}
.input:focus, select:focus, textarea:focus{border-color:var(--primary); box-shadow:0 0 0 4px rgba(14,165,164,.18); outline:none; background:var(--surface);}
textarea{resize:vertical; min-height:120px;}

.checkbox{display:flex; gap:12px; align-items:flex-start; padding:10px 12px; border-radius:var(--r-lg); background:var(--surface-muted); border:1px solid transparent; cursor:pointer; transition:border .2s ease, background .2s ease;}
.checkbox input{margin-top:6px; width:22px; height:22px; accent-color:var(--primary);}
.checkbox:hover{border-color:var(--primary-soft);}

.toggle{display:flex; justify-content:space-between; gap:16px; align-items:center; padding:14px 0; border-top:1px solid var(--line);}
.toggle:first-child{border-top:none; padding-top:0;}
.toggle:last-child{padding-bottom:0;}
.toggle__title{font-weight:700; margin:0 0 4px;}
.toggle__hint{margin:0; color:var(--muted); font-size:16px;}

.switch{position:relative; display:inline-flex; align-items:center; justify-content:flex-start; width:62px; height:34px; border-radius:999px; background:var(--line); transition:background .2s ease; cursor:pointer; flex-shrink:0;}
.switch input{position:absolute; opacity:0; width:0; height:0;}
.switch .slider{position:absolute; inset:4px; width:26px; height:26px; border-radius:50%; background:var(--surface); transition:transform .2s ease, background .2s ease; box-shadow:0 4px 10px rgba(15,23,42,.18);}
.switch input:checked + .slider{transform:translateX(28px); background:var(--primary);}
.switch input:focus-visible + .slider{outline:3px solid var(--primary); outline-offset:3px;}

/* Кнопки/чипы */
.btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; min-height:48px; padding:10px 16px; border-radius:var(--r-lg); background:var(--primary); color:#fff; border:none; font-weight:700; cursor:pointer; transition:.15s ease; box-shadow:var(--shadow-soft); text-decoration:none;}
.btn:hover{background:var(--primary-strong);}
.btn:active{transform:scale(.97);}
.btn-secondary{display:inline-flex; align-items:center; justify-content:center; gap:8px; min-height:48px; padding:10px 16px; border-radius:var(--r-lg); border:1px solid var(--primary); background:#fff; color:var(--primary); font-weight:700; cursor:pointer; transition:.2s ease; text-decoration:none;}
.btn-secondary:hover{background:var(--primary-soft);}
.btn-ghost{display:inline-flex; align-items:center; justify-content:center; gap:8px; min-height:44px; padding:8px 14px; border-radius:var(--r-md); border:1px solid transparent; background:transparent; color:var(--primary); font-weight:600; cursor:pointer; transition:color .2s ease, background .2s ease;}
.btn-ghost:hover{background:var(--primary-soft);}
.btn[disabled], .btn-secondary[disabled]{opacity:.6; cursor:not-allowed;}

.chips{display:flex; flex-wrap:wrap; gap:8px; margin:8px 0 12px;}
.chip{display:inline-flex; align-items:center; justify-content:center; min-height:40px; padding:8px 12px; border-radius:999px; background:var(--primary-soft); color:var(--primary-strong); font-weight:700; border:1px solid transparent; cursor:pointer; transition:.15s ease;}
.chip:focus-visible{outline:3px solid var(--primary);}
.chip:hover{background:var(--primary); color:#fff;}
.chip.active{background:var(--primary); color:#fff;}

/* Бейджи */
.badge{display:inline-flex; align-items:center; gap:6px; padding:6px 12px; border-radius:999px; font-size:14px; font-weight:700;}
.badge-best{background:#065F46; color:#fff;}
.badge-good{background:#10B981; color:#fff;}
.badge-neutral{background:#E2E8F0; color:#334155;}
.badge-bad{background:#E11D48; color:#fff;}

/* Скелетон/тост */
.skeleton{border-radius:var(--r-xl); background:linear-gradient(90deg,#edf7f3,#f7fbf9,#edf7f3); background-size:200% 100%; animation:s 1.4s linear infinite; width:100%; min-height:96px;}
.skeleton-compact{height:72px;}
.skeleton-medium{height:96px;}
.skeleton-tall{height:128px;}
@keyframes s{to{background-position:-200% 0;}}
.night .skeleton{background:linear-gradient(90deg,#0f172a,#111d2f,#0f172a);}
.toast{position:fixed; left:50%; transform:translateX(-50%); bottom:calc(env(safe-area-inset-bottom,0) + 96px); background:var(--primary); color:#fff; padding:12px 16px; border-radius:14px; box-shadow:0 8px 24px rgba(2,6,23,.2); display:none; font-weight:700; z-index:120;}
.toast.show{display:block;}

/* Нижняя навигация */
.tabbar{position:fixed; left:0; right:0; bottom:0; padding:10px 12px calc(env(safe-area-inset-bottom,0) + 10px); background:var(--surface); border-top:1px solid #E2E8F0; display:flex; justify-content:space-around; gap:6px; z-index:100;}
.tab{flex:1; min-height:56px; border-radius:14px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; color:var(--primary-strong); font-size:12px; font-weight:600; border:1px solid transparent; background:transparent; transition:.18s ease;}
.tab img{width:22px; height:22px;}
.tab.active{background:var(--primary-soft); font-weight:800;}
.tab:focus-visible{outline:3px solid var(--primary);}

.fab{position:fixed; right:24px; bottom:calc(120px + env(safe-area-inset-bottom,0)); width:68px; height:68px; border-radius:50%; background:var(--primary); color:#fff; font-size:28px; display:flex; align-items:center; justify-content:center; box-shadow:0 16px 32px rgba(14,165,164,.28); border:none; cursor:pointer;}
.fab.hidden{display:none;}

/* Бумажный календарь (страницы) */
.flip-wrap{perspective:1200px; display:flex; flex-direction:column; gap:20px;}
.flip-stack{position:relative; width:100%; max-width:520px; aspect-ratio:3/4; margin:0 auto;}
.page{position:absolute; inset:0; transform-style:preserve-3d;}
.calendar-sheet{position:absolute; inset:0; border-radius:20px; background:var(--surface); border:1px solid var(--line); box-shadow:0 18px 42px rgba(16,185,129,.15); display:grid; grid-template-rows:auto 1fr auto; padding:18px 18px 16px; overflow:hidden;}
.calendar-sheet::after{content:''; position:absolute; inset:0; background:linear-gradient(180deg,rgba(15,23,42,.08),transparent 40%,rgba(15,23,42,.06)); opacity:.16; pointer-events:none;}
.calendar-sheet .paper-texture{position:absolute; inset:0; background-image:radial-gradient(circle at 20% 20%, rgba(15,23,42,.08) 0, transparent 60%), radial-gradient(circle at 80% 30%, rgba(14,165,164,.08) 0, transparent 55%), radial-gradient(circle at 40% 70%, rgba(2,132,199,.08) 0, transparent 60%); background-size:240px 240px; opacity:.12; mix-blend-mode:soft-light; pointer-events:none;}
.sheet-head{position:relative; z-index:1; display:flex; justify-content:space-between; align-items:flex-start; gap:12px; min-height:40px; margin-bottom:12px;}
.sheet-head-group{display:flex; flex-direction:column; gap:4px;}
.sheet-daynum{font-size:clamp(44px, 10vw, 64px); line-height:1; font-weight:900; letter-spacing:-1px;}
.sheet-weekday{font-weight:800; color:var(--primary-strong); text-transform:capitalize;}
.sheet-badges{display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end;}
.sheet-body{position:relative; z-index:1; display:flex; flex-direction:column; gap:12px;}
.sheet-info{color:var(--muted); font-size:16px; line-height:1.4; max-height:7.5em; overflow:hidden;}
.sheet-foot{position:relative; z-index:1; display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:12px;}
.sheet-foot .btn-ghost{padding:8px 12px; min-height:44px;}
.sheet-helper{background:var(--primary-soft); color:var(--primary-strong); border-radius:var(--r-lg); padding:12px 14px; font-size:16px; display:flex; flex-direction:column; gap:6px;}
.page .front,.page .back{position:absolute; inset:0; backface-visibility:hidden;}
.page .back{transform:rotateY(180deg);}
.page.is-flipping{transition:transform 560ms cubic-bezier(.2,.7,.2,1);}
@media (prefers-reduced-motion: reduce){ .flip-wrap{perspective:none;} .page.is-flipping{transition:none;} }

.calendar-stage{position:relative; min-height:360px;}
.calendar-controls{display:flex; align-items:center; justify-content:center; gap:16px;}
.calendar-arrow{width:48px; height:48px; border-radius:999px; border:1px solid var(--line); background:var(--surface-muted); color:var(--text); font-weight:700; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:.2s ease;}
.calendar-arrow:hover{background:var(--primary-soft);}
.calendar-arrow:disabled{opacity:.45; pointer-events:none;}
.calendar-label{font-weight:800; font-size:var(--h3);}

.calendar-head{display:flex; flex-wrap:wrap; gap:16px; align-items:center; justify-content:space-between; padding:12px 0 4px;}
.calendar-head__nav{display:flex; align-items:center; gap:12px; flex:1 1 260px;}
.calendar-head__btn{display:inline-flex; align-items:center; justify-content:center; width:52px; height:52px; border-radius:999px; border:1px solid var(--line); background:var(--surface-muted); color:var(--primary-strong); font-size:20px; font-weight:800; transition:.2s ease;}
.calendar-head__btn:hover{background:var(--primary-soft);}
.calendar-head__btn[data-loading='1']{color:transparent; pointer-events:none;}
.calendar-head__title{flex:1; text-align:center; font-size:var(--h2); font-weight:800; min-height:48px; display:flex; align-items:center; justify-content:center; padding:0 8px;}
.calendar-head__today{white-space:nowrap;}

.legend{display:flex; flex-wrap:wrap; gap:12px; font-size:16px; color:var(--muted); margin-top:20px;}
.legend span{display:flex; align-items:center; gap:8px;}

/* Листы календаря при тёмной теме */
.night .calendar-sheet{box-shadow:0 18px 42px rgba(6,182,212,.24);}

/* Bottom sheet */
.sheet-overlay{position:fixed; inset:0; background:rgba(2,6,23,.42); backdrop-filter:blur(4px); opacity:0; pointer-events:none; transition:opacity .25s ease; z-index:70;}
.sheet-overlay.visible{opacity:1; pointer-events:auto;}
.bottom-sheet{position:fixed; left:0; right:0; bottom:0; background:var(--surface); border-radius:24px 24px 0 0; padding:24px; box-shadow:0 -18px 48px rgba(15,23,42,.18); border-top:1px solid var(--line); transform:translateY(100%); opacity:0; transition:transform .25s ease, opacity .25s ease; z-index:75; max-height:80dvh; overflow:auto;}
.bottom-sheet.active{transform:translateY(0); opacity:1;}
.bottom-sheet .sheet-title{font-size:var(--h2); font-weight:800; margin:0 0 4px;}
.bottom-sheet .sheet-sub{font-size:16px; color:var(--muted); margin:0 0 16px;}

/* Modal */
.modal{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:90;}
.modal.hidden{display:none;}
.modal__backdrop{position:absolute; inset:0; background:rgba(2,6,23,.5);}
.modal__content{position:relative; z-index:1; background:var(--surface); border-radius:var(--r-xl); padding:24px; width:min(92vw,480px); box-shadow:0 28px 64px rgba(15,23,42,.3); border:1px solid var(--line); display:flex; flex-direction:column; gap:18px;}
.modal__header{display:flex; justify-content:space-between; align-items:flex-start; gap:16px;}
.modal__title{margin:0; font-size:var(--h2); font-weight:800;}
.modal__body{display:flex; flex-direction:column; gap:12px; color:var(--text);}
.modal__footer{display:flex;}

/* Misc */
.list{padding-left:22px; display:flex; flex-direction:column; gap:8px;}
.list li{margin-left:4px;}
.badge-wrap{display:flex; flex-wrap:wrap; gap:8px;}
.note-box{background:var(--surface-muted); border-radius:var(--r-lg); padding:16px; color:var(--text);}
.night .note-box{background:var(--surface-alt);}
.planting-item{width:100%; text-align:left; background:var(--surface-muted); border:1px solid var(--line); border-radius:var(--r-xl); padding:18px; display:flex; flex-direction:column; gap:10px; transition:border .2s ease, transform .2s ease; cursor:pointer;}
.planting-item:hover{border-color:var(--primary); transform:translateY(-2px);}
.planting-item:focus-visible{outline:3px solid var(--primary); outline-offset:3px;}
.planting-item__category{font-size:14px; letter-spacing:.08em; text-transform:uppercase; color:var(--primary-strong);}
.planting-item__title{font-size:var(--h3); font-weight:800;}
.planting-item__dates{display:flex; flex-wrap:wrap; gap:8px;}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  *{transition-duration:0.001ms !important; animation-duration:0.001ms !important;}
  .btn:active{transform:none;}
}
